From fecb1ee15a6bb163ff1dabcf4a60b549cddabe0e Mon Sep 17 00:00:00 2001
From: Stefano Pigozzi <stefano.pigozzi@gmail.com>
Date: Mon, 15 Aug 2011 14:53:24 +0200
Subject: [PATCH 1/3] changed the window to a borderless one

---
 libvo/vo_corevideo.h |    7 ++++++-
 libvo/vo_corevideo.m |   40 ++++++++++++++++++++++++++++++++++++++--
 2 files changed, 44 insertions(+), 3 deletions(-)

diff --git a/libvo/vo_corevideo.h b/libvo/vo_corevideo.h
index 9263990..ea7bb78 100644
--- a/libvo/vo_corevideo.h
+++ b/libvo/vo_corevideo.h
@@ -39,10 +39,15 @@
 - (void) ontop;
 @end
 
+@interface MPlayerWindow : NSWindow
+- (BOOL) canBecomeKeyWindow;
+- (BOOL) canBecomeMainWindow;
+@end
+
 @interface MPlayerOpenGLView : NSOpenGLView
 {
 	//Cocoa
-	NSWindow *window;
+	MPlayerWindow *window;
 
 	//CoreVideo
 	CVPixelBufferRef frameBuffers[2];
diff --git a/libvo/vo_corevideo.m b/libvo/vo_corevideo.m
index 3b83051..7509309 100644
--- a/libvo/vo_corevideo.m
+++ b/libvo/vo_corevideo.m
@@ -438,6 +438,17 @@ static int control(uint32_t request, void *data)
 }
 
 //////////////////////////////////////////////////////////////////////////
+// NSWindow Subclass
+//////////////////////////////////////////////////////////////////////////
+@implementation MPlayerWindow
+- (BOOL) canBecomeMainWindow { return YES; }
+- (BOOL) canBecomeKeyWindow { return YES; }
+- (NSSize) aspectRatio {
+	return NSMakeSize(image_width, image_height);
+}
+@end
+
+//////////////////////////////////////////////////////////////////////////
 // NSOpenGLView Subclass
 //////////////////////////////////////////////////////////////////////////
 @implementation MPlayerOpenGLView
@@ -451,8 +462,8 @@ static int control(uint32_t request, void *data)
 	[self initMenu];
 
 	//create window
-	window = [[NSWindow alloc]	initWithContentRect:NSMakeRect(0, 0, 100, 100)
-								styleMask:NSTitledWindowMask|NSTexturedBackgroundWindowMask|NSClosableWindowMask|NSMiniaturizableWindowMask|NSResizableWindowMask
+	window = [[MPlayerWindow alloc]	initWithContentRect:NSMakeRect(0, 0, 100, 100)
+								styleMask:NSBorderlessWindowMask|NSResizableWindowMask
 								backing:NSBackingStoreBuffered defer:NO];
 
 	[window autorelease];
@@ -971,6 +982,26 @@ static int control(uint32_t request, void *data)
 	}
 }
 
+- (void)mouseDragged:(NSEvent *)theEvent {
+	NSPoint currentLocation;
+	NSPoint newOrigin;
+
+	NSRect  screenFrame = [[NSScreen mainScreen] frame];
+	NSRect  windowFrame = [self frame];
+
+	currentLocation = [NSEvent mouseLocation];
+	newOrigin.x = currentLocation.x - initialLocation.x;
+	newOrigin.y = currentLocation.y - initialLocation.y;
+
+	// Don't let window get dragged up under the menu bar
+	if( (newOrigin.y+windowFrame.size.height) > (screenFrame.origin.y+screenFrame.size.height) ){
+		newOrigin.y=screenFrame.origin.y + (screenFrame.size.height-windowFrame.size.height);
+	}
+
+	//go ahead and move the window to the new location
+	[window setFrameOrigin:newOrigin];
+}
+
 - (void) mouseDown: (NSEvent *) theEvent
 {
 	[self mouseEvent: theEvent];
@@ -1022,11 +1053,16 @@ static int control(uint32_t request, void *data)
 		switch([theEvent type])
 		{
 			case NSLeftMouseDown:
+				initialLocation = [NSEvent mouseLocation];
+				initialLocation.x -= [window frame].origin.x;
+				initialLocation.y -= [window frame].origin.y;
+				break;
 			case NSRightMouseDown:
 			case NSOtherMouseDown:
 				mplayer_put_key((MOUSE_BTN0 + buttonNumber) | MP_KEY_DOWN);
 				break;
 			case NSLeftMouseUp:
+				break;
 			case NSRightMouseUp:
 			case NSOtherMouseUp:
 				mplayer_put_key(MOUSE_BTN0 + buttonNumber);
-- 
1.7.6


From 8e6271aa98475aca2fc98d17190d7129e408ae66 Mon Sep 17 00:00:00 2001
From: Stefano Pigozzi <stefano.pigozzi@gmail.com>
Date: Mon, 15 Aug 2011 15:32:39 +0200
Subject: [PATCH 2/3] forgot to stage initial location

---
 libvo/vo_corevideo.h |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/libvo/vo_corevideo.h b/libvo/vo_corevideo.h
index ea7bb78..d21f5fd 100644
--- a/libvo/vo_corevideo.h
+++ b/libvo/vo_corevideo.h
@@ -76,6 +76,8 @@
 	//timestamps for disabling screensaver and mouse hiding
 	int lastMouseHide;
 	int lastScreensaverUpdate;
+
+	NSPoint initialLocation;
 @public
 	float winSizeMult;
 }
-- 
1.7.6


From a552c94f56941ca8cd0cc8f52627e75f0bff39e0 Mon Sep 17 00:00:00 2001
From: Stefano Pigozzi <stefano.pigozzi@gmail.com>
Date: Mon, 15 Aug 2011 16:44:00 +0200
Subject: [PATCH 3/3] removed the resize box

---
 libvo/vo_corevideo.m |   23 -----------------------
 1 files changed, 0 insertions(+), 23 deletions(-)

diff --git a/libvo/vo_corevideo.m b/libvo/vo_corevideo.m
index 7509309..f954b32 100644
--- a/libvo/vo_corevideo.m
+++ b/libvo/vo_corevideo.m
@@ -746,29 +746,6 @@ static int control(uint32_t request, void *data)
 	glEnd();
 	glDisable(CVOpenGLTextureGetTarget(texture));
 
-	//render resize box
-	if(!isFullscreen)
-	{
-		NSRect frame = [self frame];
-
-		glBegin(GL_LINES);
-		glColor4f(0.2, 0.2, 0.2, 0.5);
-		glVertex2i(frame.size.width-1, frame.size.height-1); glVertex2i(frame.size.width-1, frame.size.height-1);
-		glVertex2i(frame.size.width-1, frame.size.height-5); glVertex2i(frame.size.width-5, frame.size.height-1);
-		glVertex2i(frame.size.width-1, frame.size.height-9); glVertex2i(frame.size.width-9, frame.size.height-1);
-
-		glColor4f(0.4, 0.4, 0.4, 0.5);
-		glVertex2i(frame.size.width-1, frame.size.height-2); glVertex2i(frame.size.width-2, frame.size.height-1);
-		glVertex2i(frame.size.width-1, frame.size.height-6); glVertex2i(frame.size.width-6, frame.size.height-1);
-		glVertex2i(frame.size.width-1, frame.size.height-10); glVertex2i(frame.size.width-10, frame.size.height-1);
-
-		glColor4f(0.6, 0.6, 0.6, 0.5);
-		glVertex2i(frame.size.width-1, frame.size.height-3); glVertex2i(frame.size.width-3, frame.size.height-1);
-		glVertex2i(frame.size.width-1, frame.size.height-7); glVertex2i(frame.size.width-7, frame.size.height-1);
-		glVertex2i(frame.size.width-1, frame.size.height-11); glVertex2i(frame.size.width-11, frame.size.height-1);
-		glEnd();
-	}
-
 	glFlush();
 }
 
-- 
1.7.6

